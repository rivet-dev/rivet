---
import { getCollection } from 'astro:content';
import MarketingLayout from '@/layouts/MarketingLayout.astro';
import { RedesignedHero } from '@/components/marketing/sections/RedesignedHero';
import { ProblemSection } from '@/components/marketing/sections/ProblemSection';
import { CodeWalkthrough } from '@/components/marketing/sections/CodeWalkthrough';
import { HostingSection } from '@/components/marketing/sections/HostingSection';
import { IntegrationsSection } from '@/components/marketing/sections/IntegrationsSection';
import { ObservabilitySection } from '@/components/marketing/sections/ObservabilitySection';
import { RedesignedCTA } from '@/components/marketing/sections/RedesignedCTA';
import { ScrollObserver } from '@/components/ScrollObserver';

// Get latest changelog title
const posts = await getCollection('posts');
const changelogEntries = posts.filter((p) => p.data.category === 'changelog' && !p.data.unpublished);
const latest = changelogEntries.sort(
	(a, b) => b.data.published.getTime() - a.data.published.getTime()
)[0];

const latestChangelogTitle = latest?.data.title ?? '';
---

<MarketingLayout
	title="Rivet - Infrastructure for software that thinks."
	description="Each Rivet Actor has built-in state, storage, workflows, scheduling, and WebSockets. Long-lived stateful processes for the next generation of software. Open source."
	canonicalUrl="https://rivet.dev"
	keywords={["actors", "stateful", "workflows", "websockets", "real-time", "backend infrastructure", "serverless", "open source", "self-hosted", "AI infrastructure", "long-running processes", "state management"]}
>
	<ScrollObserver client:load>
		<div class="min-h-screen bg-black font-sans text-zinc-300 selection:bg-[#FF4500]/30 selection:text-orange-200">
			<main>
				<RedesignedHero latestChangelogTitle={latestChangelogTitle} client:load />
				<ProblemSection client:visible />
				<CodeWalkthrough client:visible />
				<IntegrationsSection client:visible />
				<ObservabilitySection client:visible />
				<HostingSection client:visible />
				<RedesignedCTA client:visible />
			</main>
		</div>
	</ScrollObserver>
</MarketingLayout>
