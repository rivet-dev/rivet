---
import BaseLayout from './BaseLayout.astro';
import { Header } from '@/components/v2/Header';
import { DocsTableOfContents } from '@/components/DocsTableOfContents';
import { ActEnd } from '@/components/learn/theatrical';

interface Props {
	title: string;
	description?: string;
	canonicalUrl?: string;
	act?: string;
	subtitle?: string;
	tableOfContents?: Array<{ title: string; id: string; children: Array<{ title: string; id: string }> }>;
	isIndex?: boolean;
	scene?: string;
}

const { title, description, canonicalUrl, act, subtitle, tableOfContents = [], isIndex = false, scene = '' } = Astro.props;

// Extract page title from title prop (remove " - Rivet" suffix if present)
const pageTitle = title.replace(/ - Rivet$/, '');
---

<BaseLayout title={title} description={description} canonicalUrl={canonicalUrl}>
	<Header active="learn" variant="full-width" learnMode client:load />

	<div class="learn-container">
		<div class="texture-overlay"></div>
		<div class="relative z-10">
			<div class:list={["px-6 py-16 md:py-24 pb-32 animate-in slide-in-from-bottom-4 duration-700", isIndex ? 'max-w-2xl mx-auto' : 'relative']}>
				{!isIndex ? (
					<>
						<main class="max-w-3xl mx-auto">
							{/* Act Header */}
							{act && (
								<header class="text-center mb-20 relative">
									<span class="font-serif italic text-[#a8a29e] text-base md:text-lg block mb-4 opacity-80">
										{act}{scene && `, ${scene}`}
									</span>
									{pageTitle && (
										<h1 class="font-display text-4xl md:text-6xl text-[#e7e5e4] mb-6 tracking-wide uppercase">
											{pageTitle}
										</h1>
									)}
									{subtitle && (
										<p class="font-serif text-[#a8a29e] text-lg md:text-xl italic mb-8">
											{subtitle}
										</p>
									)}
									<div class="w-32 h-px bg-[#d4b483] mx-auto opacity-50"></div>
								</header>
							)}

							{/* Content with theatrical MDX components */}
							<article class="prose prose-invert prose-lg md:prose-xl prose-p:font-serif prose-headings:font-display prose-headings:text-[#e7e5e4] prose-ul:list-none prose-ul:pl-6 prose-li:font-serif prose-li:before:content-['◆'] prose-li:before:text-[#d4b483] prose-li:before:mr-3 prose-li:before:opacity-60 max-w-none">
								<slot />
							</article>

							{/* Auto-generate act end marker for scene pages */}
							{scene && <ActEnd scene={scene} client:load />}
						</main>

						{/* Table of Contents - positioned on the left edge */}
						{tableOfContents.length > 0 && (
							<aside class="hidden xl:block fixed top-32 left-16 w-64 opacity-50 hover:opacity-100 transition-opacity duration-200">
								<div class="font-serif text-sm">
									<h2 class="font-display text-[#a8a29e] text-xs uppercase tracking-wider mb-2 opacity-60">
										On This Page
									</h2>
									<DocsTableOfContents
										tableOfContents={tableOfContents}
										showNewsletter={false}
										className="!pt-0 [&_a]:font-serif [&_a]:text-[#a8a29e] [&_a:hover]:text-[#e7e5e4] [&_a[aria-current=page]]:text-[#d4b483] [&_a]:px-0 [&_a]:pl-0"
										client:load
									/>
								</div>
							</aside>
						)}
					</>
				) : (
					<main>
						{/* Act Header */}
						{act && (
							<header class="text-center mb-20 relative">
								<span class="font-serif italic text-[#a8a29e] text-base md:text-lg block mb-4 opacity-80">
									{act}{scene && `, ${scene}`}
								</span>
								{pageTitle && (
									<h1 class="font-display text-4xl md:text-6xl text-[#e7e5e4] mb-6 tracking-wide uppercase">
										{pageTitle}
									</h1>
								)}
								{subtitle && (
									<p class="font-serif text-[#a8a29e] text-lg md:text-xl italic mb-8">
										{subtitle}
									</p>
								)}
								<div class="w-32 h-px bg-[#d4b483] mx-auto opacity-50"></div>
							</header>
						)}

						{/* Content with theatrical MDX components */}
						<article class="prose prose-invert prose-lg md:prose-xl prose-p:font-serif prose-headings:font-display prose-headings:text-[#e7e5e4] prose-ul:list-none prose-ul:pl-6 prose-li:font-serif prose-li:before:content-['◆'] prose-li:before:text-[#d4b483] prose-li:before:mr-3 prose-li:before:opacity-60 max-w-none">
							<slot />
						</article>
					</main>
				)}
			</div>
		</div>
	</div>
</BaseLayout>
