---
import BaseLayout from './BaseLayout.astro';
import { Header } from '@/components/v2/Header';

interface Props {
	title: string;
	description?: string;
	canonicalUrl?: string;
	ogImage?: string;
	publishedTime?: string;
	modifiedTime?: string;
	keywords?: string[];
	authorName?: string;
	authorSocials?: { twitter?: string; github?: string; bluesky?: string };
	category?: string;
}

const { title, description, canonicalUrl, ogImage, publishedTime, modifiedTime, keywords, authorName, authorSocials, category } = Astro.props;

// Build sameAs array from author socials
const authorSameAs = authorSocials ? Object.values(authorSocials).filter(Boolean) : [];

const articleSchema = {
	"@context": "https://schema.org",
	"@type": "Article",
	"headline": title,
	"description": description,
	"url": canonicalUrl,
	"datePublished": publishedTime,
	"dateModified": modifiedTime || publishedTime,
	"author": {
		"@type": "Person",
		"name": authorName || "Rivet Team",
		...(authorSameAs.length > 0 && { "sameAs": authorSameAs })
	},
	"publisher": {
		"@type": "Organization",
		"name": "Rivet",
		"url": "https://rivet.dev",
		"logo": {
			"@type": "ImageObject",
			"url": "https://rivet.dev/icons/android-chrome-512x512.png"
		}
	},
	"mainEntityOfPage": {
		"@type": "WebPage",
		"@id": canonicalUrl
	},
	...(ogImage && { "image": ogImage })
};
---

<BaseLayout
	title={title}
	description={description}
	canonicalUrl={canonicalUrl}
	ogImage={ogImage}
	ogType="article"
	publishedTime={publishedTime}
	keywords={keywords}
	articleAuthor={authorName}
	articleSection={category}
>
	<script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
	<Header active="blog" variant="floating" client:load />
	<slot />
</BaseLayout>
