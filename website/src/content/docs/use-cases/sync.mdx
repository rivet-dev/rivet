# Local-First Sync

## Challenges of Building Local-First Sync

Common tools: ElectricSQL, PowerSync, custom sync protocols, CRDTs, WebSockets, PostgreSQL logical replication

Main pain points:
- Complex conflict resolution when syncing offline changes to server
- Managing sync state and tracking changes across devices
- Handling partial syncs and large datasets efficiently
- Infrastructure for WebSocket connections and pub/sub for realtime updates
- Coordinating between client-side databases and server-side storage

## How Rivet Solves This

Rivet actors provide stateful sync coordination with built-in realtime updates and automatic persistence.

**Per-User Sync Actors**: Each user gets a dedicated actor to manage their sync state and coordinate updates across devices.

```typescript
const userSync = actor({
  state: {
    syncedData: {} as Record<string, any>,
    lastSyncTimestamp: 0,
    deviceStates: {} as Record<string, { lastSeen: number, version: number }>
  },

  actions: {
    sync: (c, deviceId: string, changes: any[], clientVersion: number) => {
      // Merge changes with conflict resolution
      const merged = mergeChanges(c.state.syncedData, changes, clientVersion);
      c.state.syncedData = merged.data;
      c.state.lastSyncTimestamp = Date.now();
      c.state.deviceStates[deviceId] = {
        lastSeen: Date.now(),
        version: clientVersion
      };

      // Broadcast to other devices
      for (const conn of c.conns) {
        if (conn.state.deviceId !== deviceId) {
          conn.send("syncUpdate", { changes: merged.newChanges });
        }
      }

      return { data: merged.data, version: merged.version };
    }
  },

  createConnState: (c, opts, params: { deviceId: string }) => ({
    deviceId: params.deviceId
  })
});
```

**Automatic State Persistence**: Sync state persists automatically without external databases. See [state management](/docs/actors/state).

**Realtime Cross-Device Sync**: Broadcast updates to all connected devices instantly using [events](/docs/actors/events).

**Connection Tracking**: Monitor online/offline devices using [connection state](/docs/actors/connections).

**Conflict Resolution**: Implement custom merge strategies directly in actor logic with full access to state history.

## Full Example Projects

<CardGroup>
<Card href="https://github.com/rivet-dev/rivet/tree/main/examples/sync" title="Local-First Sync Example" />
</CardGroup>
