# Per-User Database

## Challenges of Building Per-User Databases

Common tools: PostgreSQL with row-level security, MongoDB with tenant isolation, SQLite per-user files, DynamoDB with partition keys

Main pain points:
- High latency from database round trips for every read/write operation
- Complex query patterns to ensure tenant isolation and prevent data leaks
- Scaling challenges when users have large datasets
- Managing database connections and connection pooling per-tenant
- Expensive database operations for simple key-value access patterns

## How Rivet Solves This

Rivet actors provide isolated in-memory databases for each user with automatic persistence and zero-latency access.

**Isolated User State**: Each user gets their own actor with completely isolated state, eliminating tenant isolation concerns.

```typescript
const userDatabase = actor({
  state: {
    documents: {} as Record<string, any>,
    settings: {},
    metadata: { createdAt: 0, lastAccess: 0 }
  },

  actions: {
    set: (c, key: string, value: any) => {
      c.state.documents[key] = value;
      c.state.metadata.lastAccess = Date.now();
      return value;
    },

    get: (c, key: string) => {
      c.state.metadata.lastAccess = Date.now();
      return c.state.documents[key];
    },

    query: (c, filter: (doc: any) => boolean) => {
      return Object.entries(c.state.documents)
        .filter(([_, doc]) => filter(doc))
        .map(([key, doc]) => ({ key, ...doc }));
    }
  }
});
```

**Zero-Latency Reads**: State lives in memory on the same machine as compute, making reads instant with no database round trips. See [state management](/docs/actors/state).

**Automatic Persistence**: Data persists automatically without manual save operations or database drivers.

**Built-in SQLite Support**: Use SQLite databases within actors for relational data. See [external SQL](/docs/actors/external-sql) for integration with traditional databases.

**Realtime Updates**: Broadcast data changes to connected clients using [events](/docs/actors/events).

## Full Example Projects

<CardGroup>
<Card href="https://github.com/rivet-dev/rivet/tree/main/examples/database" title="Per-User Database Example" />
</CardGroup>
